---
layout: post
title: "【ThinkPad R400 7445A45】枯木逢春"
subtitle: "草稿..."
background: '/img/bg-bagtravel.jpg'
published: false
imagefolder: "r400upgrade"
---

使用SSD接近其容量，其写入性能将急剧下降，原因在于SSD的工作方式。SSD以数据块为单位写入数据，一个256KB的数据块（Block）包含64个4KB大小的数据页（Page）。

写入空白数据块是最快的，但对部分写入的数据块来说，一个简单的写操作就变成了

1. 将数据块读入SSD缓存中
1. 添加新的数据页
1. 擦除原数据块
1. 将缓存中的新数据块写入

再加上写入一个文件要写入很多数据块，当SSD越用越满，剩下的全部是部分写入的数据块，能不慢吗:scream:

当然，厂商也不会坐以待毙。有些厂商会额外提供一些容量，比如总容量的7%，这部分容量对用户和操作系统不可见，这样就大大减少了使用部分写入的数据块的机会。

SSD控制器有个垃圾回收算法尝试去缓解这个问题，当使用容量超过一定阈值的时候，它就会去搜寻部分写入的数据块然后合并它们，释放尽可能多的空白数据块。

有人做过实验，想梳理出SSD空闲空间和写入性能之间的关系，他们的结论是**尽量避免使用超过75%的容量**

{% include image.html imgs="nand-flash-memory-pages-and-blocks.png: 页和块"  w="28" %}